<!doctype html>
<html>
<head>
<style>
textarea {
    margin: 20px;
    display: block;
    box-sizing: border-box;
    border: solid 1px hsl(0,0%,60%);
    background: hsl(0,0%,80%);
}
textarea.activeEditor {
    background: hsl(0,0%,100%);
}
</style>
</head>
<body>
<script src="../../js/tinymce/tinymce.dev.js"></script>
<script src='lodash.js'></script>
<script src='jquery.js'></script>
<script>
for (var i=0; i < 4; i++) {
    $('body').append($('<textarea>').attr('id', 'textarea-'+i))
}

function closeActiveEditor() {
    if (!tinymce.activeEditor) return;

    tinymce.activeEditor.off('blur');
    $(tinymce.activeEditor.id).removeClass('activeEditor')
    tinymce.activeEditor.remove();
    console.warn('removed');
}

$('body').on('focus', 'textarea', function(focusEvent) {
    console.warn("CREATE");
    closeActiveEditor();

    var thisTextarea = this
    if ($(thisTextarea).hasClass('activeEditor')) {
        console.log("WEFWEFWEF");
    }
    $(thisTextarea).addClass('activeEditor')
    tinymce.createEditor(thisTextarea, {
        auto_focus: true
    })
    tinymce.activeEditor.render();
    tinymce.activeEditor.on('blur', function(blurEvent) {
        console.warn("BLURRRRRRRRR");
        closeActiveEditor($(thisTextarea));
    })
})
</script>
</body>
</html>
